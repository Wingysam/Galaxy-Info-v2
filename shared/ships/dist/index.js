var ee=Object.create;var f=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var H=s=>f(s,"__esModule",{value:!0});var I=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),ie=(s,e)=>{H(s);for(var t in e)f(s,t,{get:e[t],enumerable:!0})},ne=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of re(e))!ae.call(s,r)&&r!=="default"&&f(s,r,{get:()=>e[r],enumerable:!(t=te(e,r))||t.enumerable});return s},oe=s=>ne(H(f(s!=null?ee(se(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var U=I((ge,K)=>{K.exports=function(e){e=e.toLowerCase();var t={for:function(r){var a=0,i={found:!0};r=r.toLowerCase();for(var c=r.length,d=0;d<c;d++){if(a=e.indexOf(r[d],a),a===-1)return{found:!1};d==0&&(i.start=a)}return i.end=a+1,i}};return t}});var j=I((fe,W)=>{W.exports=function(e,t){for(var r=e.length,a=Math.ceil(r*t)||1,i=[],c=r;c>=a;){for(var d=r-c,n=0;n<=d;n++){var o=e.substr(n,c);i.indexOf(o)===-1&&i.push(o)}c--}return i}});var Q=I((ye,q)=>{var le=U(),he=j();q.exports=function(e,t,r){if(typeof e!="string"||e==="")return t;r=r||{};var a=r.accessor||function(n){return n},i=r.precision===void 0?1:r.precision,c=[],d=he(e,i);return t.forEach(function(n){var o=a(n);d.find(function(N){var m=le(o).for(N);return m.found&&c.push({gram:N,length:m.end-m.start,start:m.start,searchableItem:o,item:n}),m.found})}),c.sort(function(n,o){return n.gram.length!==o.gram.length?o.gram.length-n.gram.length:n.length!==o.length?n.length-o.length:n.start!==o.start?n.start-o.start:n.searchableItem>o.searchableItem?1:n.searchableItem<o.searchableItem?-1:0}).map(function(n){return n.item})}});ie(exports,{Alpha:()=>l,BASE_REQUIREMENTS:()=>pe,BUILD_MENU_CLASSES:()=>ce,CLAMPS:()=>g,CLASSES:()=>ue,ClientShips:()=>Y,ClientTurrets:()=>J,DAMAGE_TYPE_DISTRIBUTIONS:()=>h,Dps:()=>p,NON_LIMITED_QUEST_SHIPS:()=>de,PERMITS:()=>S,RESISTANCE:()=>D,SPINALS:()=>y,SPINAL_RELOAD_EXPONENT:()=>A,ServerShips:()=>$,ServerTurrets:()=>V,Ship:()=>x,ShipFighters:()=>O,ShipNotFoundError:()=>b,ShipSpinal:()=>w,ShipSpinalGun:()=>P,ShipSpinals:()=>R,ShipTurrets:()=>L,ShipWeapons:()=>k,Ships:()=>v,ShipsNotDumpedError:()=>M,ShipsNotInitializedError:()=>E,TURRET_CLASS_DAMAGE_DISTRIBUTIONS:()=>C,TurretNotFoundError:()=>B,Turrets:()=>T,TurretsNotDumpedError:()=>_,TurretsNotInitializedError:()=>F,Weapon:()=>u});var X=oe(Q());var ue=["Miner","Freighter","Frigate","Destroyer","Cruiser","Battlecruiser","Battleship","Dreadnought","Carrier","Super Capital","Fighter","Titan","Alien","Admin"],h={Laser:{shield:1,hull:.3,ideal:"shield"},Kinetic:{shield:.4,hull:1,ideal:"hull"},Plasma:{shield:1,hull:.7,ideal:"shield"},Missile:{shield:.7,hull:1,ideal:"hull"}},C={Mining:h.Laser,Laser:h.Laser,Railgun:h.Kinetic,Flak:h.Kinetic,Cannon:h.Kinetic,PDL:h.Laser},y={Phaser:{damageDistribution:h.Laser,Tiny:{damage:28,reload:.8,range:3e3,velocity:5e3},Small:{damage:40,reload:1,range:4e3,velocity:4500},Medium:{damage:72,reload:1.6,range:5e3,velocity:4e3},Large:{damage:120,reload:2.4,range:6e3,velocity:3500},Huge:{damage:198,reload:3.6,range:6500,velocity:3e3}},Cannon:{damageDistribution:h.Kinetic,Tiny:{damage:40,reload:1.6,range:3e3,velocity:3e3},Small:{damage:60,reload:2,range:4e3,velocity:2800},Medium:{damage:112,reload:3.2,range:5e3,velocity:2600},Large:{damage:160,reload:4,range:6e3,velocity:2400},Huge:{damage:270,reload:6,range:6500,velocity:2200}},Torpedo:{damageDistribution:h.Missile,Tiny:{damage:200,reload:5,range:5e3,velocity:700},Small:{damage:330,reload:6,range:6e3,velocity:600},Medium:{damage:490,reload:7,range:7e3,velocity:500},Large:{damage:680,reload:8,range:9e3,velocity:400},Huge:{damage:900,reload:9,range:1e4,velocity:300}}},A=1.1,S={"37":"SC Build","38":"Class A","39":"Class B","40":"Class C","41":"Class D","42":"Class E"},D={Fighter:0,Frigate:.2,Destroyer:.25,Cruiser:.3,Battlecruiser:.4,Battleship:.45,Dreadnought:.5,Carrier:.55,"Super Capital":.65,Titan:.7,Miner:.3,Freighter:.1,Alien:.3,Admin:.9},pe={Fighter:1,Frigate:1,Destroyer:1,Cruiser:1,Battlecruiser:1,Battleship:1,Dreadnought:2,Carrier:2,"Super Capital":3,Titan:1,Miner:1,Freighter:1,Alien:1,Admin:1},ce=["Miner","Freighter","Frigate","Destroyer","Cruiser","Battlecruiser","Battleship","Dreadnought","Carrier","Super Capital"],g={turnSpeed:[.1,.9],topSpeed:[45,380],acceleration:[5,50]},de=["Nightmare","Atheon","Zhen","Helios","Imperator","Osiris","Slipstream"];var u=class{},l=class{constructor(e,t,r){this.shield=e??0,this.hull=t??0,this.max=r??0}add(...e){for(let t of e)this.shield+=t.shield,this.hull+=t.hull,this.max+=t.max;return this}multiply(e){return this.shield*=e,this.hull*=e,this.max*=e,this}},p=class{constructor(e,t){this.shield=e??0,this.hull=t??0}add(...e){for(let t of e)this.shield+=t.shield,this.hull+=t.hull;return this}multiply(e){return this.shield*=e,this.hull*=e,this}get average(){return(this.shield+this.hull)/2}};var E=class extends Error{},M=class extends Error{},b=class extends Error{constructor(){super("Could not find a ship with that name.")}};function z(...s){console.log("[Ships]",...s)}function G(s,e,t){return Math.min(Math.max(s,e),t)}var v=class{constructor(e){this.ships={},this.turrets=e,this.initialized=!1}assertReady(){if(!this.initialized)throw new E("Ships instance has not been initialized; do `await <Ships>.init()` before using it.");if(Object.keys(this.ships).length===0)throw new M("Ships have not been exported from the game.")}async load(e){this.ships={},await this.loadShips(e,this.turrets,!0),await this.loadShips(e,this.turrets,!1),this.initialized=!0}async loadShips(e,t,r){for(let a of Object.values(e))try{if(!r&&a.class==="Fighter"||r&&a.class!=="Fighter")continue;let i=new x(this.ships,t,a);this.ships[i.name]=i}catch{}}find(e){if(this.assertReady(),this.ships.hasOwnProperty(e))return this.ships[e];let t=(0,X.default)(e,Object.keys(this.ships))[0];if(!t)throw new b;return this.ships[t]}all(e){this.assertReady(),e||(e={});let t={};for(let r in this.ships)e.secret===!1&&(this.ships[r].secret||this.ships[r].test)||(t[r]=this.ships[r]);return t}get(e){if(this.assertReady(),!this.ships.hasOwnProperty(e))throw new b;return this.ships[e]}fromSerializedShip(e){return this.assertReady(),new x(this.ships,this.turrets,e)}},x=class{constructor(e,t,r){this.serializedShip=r,this.name=r.name,this.test=r.test,this.class=r.class,this.resistance=D[this.class],this.description=r.description??"(no description)",this.eventId=r.eventId,this.permit=this.calculatePermit(),this.explosionSize=r.explosionSize,this.notForSale=r.notForSale,this.cargoHold=r.cargoHold,this.oreHold=r.oreHold,this.secret=r.secret,this.nonPlayer=r.nonPlayer||["Alien","Titan"].includes(this.class),this.canWarp=r.canWarp,this.stealth=r.stealth,r.customDrift&&(this.customDrift=r.customDrift,this.vip=r.vip),this.health=r.health,this.speed={top:r.topSpeed,acceleration:r.acceleration,turn:r.turnSpeed},this.weapons=new k(t,r.weapons),this.fighters=new O(e,r.fighters),this.extraMaterials=r.extraMaterials,this.speed.turn=G(this.speed.turn,...g.turnSpeed),this.secret||(this.speed.top=G(this.speed.top,...g.topSpeed),this.speed.acceleration=G(this.speed.acceleration,...g.acceleration))}calculatePermit(){if(!this.eventId||!this.serializedShip.permitOverride)return null;let e=this.serializedShip.permitOverride.toString();if(!(e in S))throw new Error(`Unknown permit override: ${e}`);return S[e]}},k=class extends u{constructor(e,t){super();this.turrets=new L(e,t.turrets),this.spinals=new R(t.spinals)}alpha(e,t=0){let r=this.turrets.alpha(e,t),a=this.spinals.alpha(e);return r.add(a)}dps(e,t=0){let r=this.turrets.dps(e,t),a=this.spinals.dps(e);return r.add(a)}},L=class extends u{constructor(e,t){super();this.turrets=new Map;for(let r of t){let a=e.get(r);this.incrementTurret(a)}}incrementTurret(e){let t=this.turrets.get(e)??0;this.turrets.set(e,t+1)}alpha(e,t=0){let r=new l;for(let[a,i]of this.turrets)r.add(a.alpha(e).multiply(i).multiply(1+t));return r}dps(e,t=0){let r=new p;for(let[a,i]of this.turrets)r.add(a.dps(e).multiply(i).multiply(1+t));return r}},R=class extends u{constructor(e){super();this.spinals=[],e.f&&(this.f=new w(e.f),this.spinals.push(this.f)),e.g&&(this.g=new w(e.g),this.spinals.push(this.g))}alpha(e){return new l().add(...this.spinals.map(t=>t.alpha(e)))}dps(e){return new p().add(...this.spinals.map(t=>t.dps(e)))}},w=class extends u{constructor(e){super();this.range=y[e.weaponType][e.weaponSize].range,this.guns=[];for(let r of e.guns)this.guns.push(new P(e,r));if(this.guns.length===0)throw new Error("Spinal has no guns");this.interval=this.guns[0].interval,this.weaponSize=e.weaponSize,this.weaponType=e.weaponType,this.barrels=0;let t=this.guns[0];for(let r of this.guns)this.barrels+=r.barrels,r.barrels>t.barrels&&(t=r);typeof e.reloadOverride!="undefined"?this.reload=Math.max(.01,e.interval*(t.barrels-1)+e.reloadOverride):this.reload=t.reload}alpha(e){return e&&e>this.range?new l:new l().add(...this.guns.map(t=>t.alpha()))}dps(e){let t=this.alpha(e);return new p(t.shield/this.reload,t.hull/this.reload)}},P=class extends u{constructor(e,t){super();let r=y[e.weaponType],a=r[e.weaponSize];this._alpha=new l(t.barrels*a.damage*r.damageDistribution.shield,t.barrels*a.damage*r.damageDistribution.hull,t.barrels*a.damage*r.damageDistribution[r.damageDistribution.ideal]),this.interval=e.interval,this.reload=this.interval*(t.barrels-1)+a.reload*Math.pow(A,t.barrels-1),this.barrels=t.barrels}alpha(){return new l().add(this._alpha)}dps(){return new p(this._alpha.shield/this.reload,this._alpha.hull/this.reload)}},O=class extends u{constructor(e,t){super();this.hasFighters=!1,this.fighters=new Map;for(let r of t)try{let a=e[r];if(!a)continue;this.incrementFighter(a),this.hasFighters=!0}catch(a){z(a)}}incrementFighter(e){let t=this.fighters.get(e)??0;this.fighters.set(e,t+1)}alpha(e,t=0){let r=new l;for(let[a,i]of this.fighters)r.add(a.weapons.alpha(e,t).multiply(i));return r}dps(e,t=0){let r=new p;for(let[a,i]of this.fighters)r.add(a.weapons.dps(e,t).multiply(i));return r}},Y=class extends v{constructor(e){super(e)}async init(e){await super.load(e)}},$=class extends v{constructor(e){super(e.turrets);this.GalaxyInfo=e}async init(){try{let e=await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:this.GalaxyInfo.config.db.kvKeys.serializedShips},rejectOnNotFound:!0}),t=await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:this.GalaxyInfo.config.db.kvKeys.serializedTestShips},rejectOnNotFound:!0});await super.load({...e.value,...t.value})}catch(e){z("Ships database reset.",e)}z("Initialized")}async save(e,t){await this.GalaxyInfo.prisma.keyValue.upsert({create:{key:t?this.GalaxyInfo.config.db.kvKeys.serializedTestShips:this.GalaxyInfo.config.db.kvKeys.serializedShips,value:e},update:{value:e},where:{key:t?this.GalaxyInfo.config.db.kvKeys.serializedTestShips:this.GalaxyInfo.config.db.kvKeys.serializedShips}});let r=(await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:t?this.GalaxyInfo.config.db.kvKeys.serializedShips:this.GalaxyInfo.config.db.kvKeys.serializedTestShips},rejectOnNotFound:!0})).value;await super.load({...e,...r})}};var F=class extends Error{},_=class extends Error{},B=class extends Error{},T=class{constructor(){this.turrets={},this.initialized=!1}assertReady(){if(!this.initialized)throw new F("Turrets instance has not been initialized; do `await <Turrets>.init()` before using it.");if(Object.keys(this.turrets).length===0)throw new _("Turrets have not been exported from the game.")}async load(e){for(let t of Object.values(e)){let r=new Z(t);this.turrets[r.name]=r}this.initialized=!0}get(e){if(this.assertReady(),!this.turrets.hasOwnProperty(e))throw new B(`Could not find turret called ${e}.`);return this.turrets[e]}all(){return this.assertReady(),this.turrets}},Z=class extends u{constructor(e){super();let t=e.Group==="Alien"?h.Plasma:C[e.Class];this._alpha=new l(e.Damage*t.shield,e.Damage*t.hull,e.Damage*t[t.ideal]),this.name=e.Name,this.range=e.Range,this.reload=e.Reload,this.group=e.Group,this.size=e.TurretSize,this.turretClass=e.Class,this.baseAccuracy=e.BaseAccuracy,this.trackingAccuracy=e.SpeedDenominator,this.test=["Test","Modelers"].includes(this.group),this.affectedByLoyalty=!["Mining"].includes(e.Class)}alpha(e,t=0){return this.affectedByLoyalty||(t=0),e&&e>this.range?new l:new l().add(this._alpha).multiply(1+t)}dps(e,t=0){let r=this.alpha(e,t);return new p(r.shield/this.reload,r.hull/this.reload)}accuracyDeviation(e){return this.size==="Large"&&e>80&&(e*=1+(e-80)*.003),this.size==="Medium"&&e>120&&(e*=1+(e-120)*.003),this.size==="Small"&&e>170&&(e*=1+(e-170)*.003),this.baseAccuracy+e/this.trackingAccuracy}},J=class extends T{constructor(){super()}async init(e){await super.load(e)}},V=class extends T{constructor(e){super();this.GalaxyInfo=e}async init(){try{let e=await this.GalaxyInfo.prisma.keyValue.findUnique({where:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets},rejectOnNotFound:!0});await this.load(e.value)}catch{console.log("Turrets database reset.")}}async save(e){await this.GalaxyInfo.prisma.keyValue.upsert({create:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets,value:e},update:{value:e},where:{key:this.GalaxyInfo.config.db.kvKeys.serializedTurrets}}),await this.load(e)}};
